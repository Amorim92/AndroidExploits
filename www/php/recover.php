<?php 
	header("Access-Control-Allow-Origin: *");
	header('Content-type: application/json');

	$host="db.ist.utl.pt";	// o MySQL esta disponivel nesta maquina
	$user="ist170038";	// -> substituir pelo nome de utilizador
	$password="xnoe2920";	// -> substituir pela password dada pelo mysql_reset
	$dbname = $user;	// a BD tem nome identico ao utilizador

	$connection = new PDO("mysql:host=" . $host. ";dbname=" . $dbname, $user, $password, array(PDO::ATTR_ERRMODE => PDO::ERRMODE_WARNING));

	$mail=$_POST['mail'];

	$login = 'SELECT * FROM Users WHERE email = "' .$mail. '";';
	$result = $connection->query($login);

	//THIS IS UGLY AS FUCK BUT IM TIRED
	$flag = false;
	foreach($result as $row){
		mail($mail, "inSecure Network: Password", "Hi there " .$row["name"]. ". Your password is " .$row["pass"]. ". As you can see, whe store passwords in plain text in our database, this means that if you can access our table, you are able to steal all creditials. To good we are SQL Injection bullet prove....");
		$flag = true;
		break;
	}

	if($flag){
		$response_array['status'] = 'success'; 
	} else {
		// no email
		$response_array['status'] = 'error'; 
	}

	$connection = null;
	
	json_encode($response_array);
	echo json_encode($response_array);
?>